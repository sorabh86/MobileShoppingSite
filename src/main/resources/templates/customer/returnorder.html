<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments :: page_head('Customer | Return Order')" />
<body>
<div class="d-flex flex-column" style="min-height:100vh">
	<div th:replace="fragments::top_navigation('customer')" />
	<div th:replace="fragments::main_navigation('customer')" />
	<div class="ml-5 mr-5 mt-4 d-flex flex-grow-1">
		<div class="row flex-grow-1">
			<div th:replace="fragments::customer_menu('return')"></div>
			<div class="col">
				<div th:if="${message!=null}" class="alert alert-success">
					[[${message}]]
				</div>

				<h3 class="border-bottom pb-3 mb-4">Return Order</h3>
				
				<div class="alert alert-success" th:if="${message}">[[${message}]]</div>
				<table class="table table-striped table-bordered">
					<thead class="thead-dark">
						<tr>
							<th>Id</th>
							<th>Order Date</th>
							<th>Order Details</th>
							<th>Return Status</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="order: ${orders}" th:class="${order.isVisited?'bg-visted order order-'+order.id:'order order-'+order.id}" >
							<td>[[${order.id}]]</td>
							<td class="order-date text-center">
								<div class="date-date">[[${#dates.format(order.created_date,"dd/MM/yy hh:mm")}]]</div>
							</td>
							<td class="order-items" th:with="orderItems = ${order.orderItems}">
								<span class="m-0 item" style="position:relative" th:each="orderItem, status : ${orderItems}"> 
									[[${status.count+".   "+orderItem.phone.title+"    X"+orderItem.quantity+" = "+orderItem.amount}]]
									<br th:if="${status.count!=order.orderItems.size()}" />
								</span>
								<strong class="total-amount text-danger float-right d-block">[[${order.grandTotal}]]</strong>
							</td>
							<td>
								<span th:if="${order.returnOrders.isEmpty}">Not Requested</span>
								<span th:if="${!order.returnOrders.isEmpty}">[[${order.returnOrders.get(0).status}]]</span>
							</td>
							<td>
								<a th:if="${order.isReturnable && order.returnOrders.isEmpty}" class="return-btn text-primary" th:data-id="${order.id}" href="#">Return</a>
								<span th:if="${!order.isReturnable}">Return time expired</span> 
								<span th:if="${!order.returnOrders.isEmpty}">Already Submitted</span> 
							</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>	
	</div>
	
	<div class="mt-auto">
		<footer th:replace="fragments::footer()" />
	</div>
</div>
<div id="orderreturnwindow" class="modal" tabindex="-1" role="dialog">
	<div class="modal-dialog modal-lg modal-dialog-centered" role="document">
		<div class="modal-content">
			<div class="modal-header bg-dark text-light">
				<h3>Return Order</h3>
				<button type="button" class="close text-light" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form name="returnForm" method="post" th:action="@{/customer/return/save}">
					<input type="hidden" name="orderId" />
					<input type="hidden" name="status" value="REQUESTED" />
					<input type="hidden" name="returnReason"/>
					<div class="form-group row">
						<label class="col-4 col-form-label text-right">Choose your reason:</label>
						<div class="col-8">
							<select name="complaintype" class="form-control" required>
								<option value="">Please choose</option>
								<option>Damaged Item Received</option>
								<option>Missing Component in package</option>
							</select>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-4 col-form-label text-right">Describe Problem:</label>
						<div class="col-8">
							<textarea name="reason" class="form-control" rows="4" required></textarea>
							<small class="text-info">We will send our agents based on situation found : <br />
							* We will fixed your item <br />
							* We will replace/repair your item <br />
							* We will return and refund your money. <br />
							You will be contacted as soon as possible.</small>
						</div>
					</div>
					<div class="form-group row">
						<label class="col-4 col-form-label"></label>
						<div class="col-8">
							<button type="submit" class="btn btn-primary mr-3">Submit</button>
							<button type="button" data-dismiss="modal" class="btn btn-secondary">Cancel</button>
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
	
<div id="loading">
	<div class="spinner-border text-light"
		style="position: fixed; left: 50%; top: 50%">
		<span class="sr-only">Loading...</span>
	</div>
</div>
	
<script>
	var $orderreturnwindow = $("#orderreturnwindow");
	var returnForm = document.forms.returnForm;
	
	// show return modal
	$(".return-btn").on("click", function(){
		returnForm['orderId'].value = $(this).data("id");
		$orderreturnwindow.modal();
		return false;
	});
	
	// submit return form
	$(returnForm).on("submit", function(){
		if(returnForm.complaintype.value!='' && returnForm.reason.value!='') {
			returnForm['returnReason'].value = returnForm.complaintype.value+" : "+returnForm.reason.value;
			return true;			
		}
		return false;
	});
</script>
</body>
</html>